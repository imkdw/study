# 피드 발행 흐름 상세설계

### 웹 서버

- 인증이나 처리율 제한 등의 기능도 수행
- 인증 : Authorization 토큰을 통해 올바른 사용자인지 검증함
- 처리율 제한 : 스팸과 중복콘텐츠 제한을 위해서 사용자가 올릴수있는 포스팅 수 제한이 필요

<br>

### 포스팅 전송(fanout) 서비스

- fanout : 특정 유저가 새로운 피드를 올리면, 해당 사용자와 친구관계에 있는 모든 사용자에게 전달하는 과정
- 쓰기 시점 팬아웃(fanout-on-write), 읽기 시점 팬아웃(fanout-on-read) 방식이 있음

<br>

### 쓰기 시점 팬아웃

- 새로운 포스팅을 기록하는 시점에 뉴스피드를 갱신, 포스팅이 완료되면 바로 해당 유저의 캐시에 해당 포스팅을 기록
- 뉴스 피드가 실시간으로 갱신되고, 친구 목록에 있는 유저에게 즉시 전송됨
- 새로운 포스팅이 기록되는 순간 뉴스 피드가 이미 갱신되므로 뉴스 피드를 읽는 데 필요한 시간이 짧아짐
- 친구가 많은 유저의 경우는 친구 목록을 가져오고 그 목록에 있는 유저 모두의 뉴스 피드를 갱신하는게 많은 시간이 소요될 수 있음
  - 이는 핫키라고 부르는 문제임
- 서비스를 자주 이용하지 않는 사용자의 피드까지 갱신해야 하므로 컴퓨팅 자원이 낭비됨

<br>

### 읽기 시점 팬아웃

- 피드를 읽어야 하는 시점에 뉴스 피드를 갱신함, 요청 기반 모델임, 유저가 본인 홈페이지나 타임라인을 로딩하는 시점에 새로운 포스트를 가져오게됨
- 비활성화된 사용자나 서비스에 거의 로그인하지 않는 사용자에 경우는 해당 모델이 유리함, 로그인 전까진 어떠한 자원도 사용하지 않음
- 데이터를 친구 각각에 푸시하는 작업이 필요 없어서 핫키 문제도 생기지 않음
- 대신 뉴스 피드를 읽는데 많은 시간이 소요될 수 있음
