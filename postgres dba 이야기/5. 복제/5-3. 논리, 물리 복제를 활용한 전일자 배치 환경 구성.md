## 상황
- 매일 00시 30분 기준으로 전일 데이터를 활용해서 배치 작업을 수행한다고 가정한다
- 가장 간단한 방법은 OS 차원에서 제공하는 디스크 스냅샷 기능을 사용하는 것이다
- 하지만 테이블도 일부만 존재하고, 복잡한 JOIN 쿼리가 필요하다면 적절하지 않낟

<br>

## 방법
- 위 같은 상황에서는 논리 및 물리 복제를 혼합해서 활용하는 구성을 고려할 수 있다
- 각 서버에서 필요한 테이블만 선별해서 하나의 통합 논리 복제 서버로 복제한다
- 이 통합 복제 서버에는 물리 복제를 통해 리플리카 서버를 구성한다
- 리플리카 서버가 실제로 배치 작업을 수행할 대상 서버가 되는것이다

<br>

## 상세방법
- 00시 30분이 되면 복제 지연 여부를 확인하고 논리 복제를 중단시킨다
  - 한 쪽 서버에서 `alter subscription <subscription_name> disable`을 통해서 중단시킨다
  - 중단시키면 논리 복제와 관련된 모든 프로세스가 중단됨
- 이제 통합 복제서버(리플리카)에는 특정 시점 기준의 데이터가 존재하게되는데 여기서 마스터로 승격시킴
  - `pg_ctl promote`를 통해서 리플리카 서버를 마스터로 승격시킬수 있음
- 승격이 완료되면 다시 중단했던 subscription을 활성화한다
  - `alter subscription <subscription_name> enable`을 통해서 활성화한다
- 마스터로 승격된 통합 논라 복제 서버의 배치 작업이 완료되면 `pg_basebackup`을 통해서 리플리카 서버를 재구성한다