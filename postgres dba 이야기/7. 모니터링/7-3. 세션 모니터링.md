## 세션 모니터링
- 디비 성능 모니터링에서 가장 핵심적인 요소는 세션 모니터링임
- 해당 정보를 통해서 접속중인 세션, 쿠리 수행 정보 등 다양한 내용 확인이 가능함
- `pg_stat_activity` 뷰를 통해서 세션 단위 모니터링 수행이 가능함

<br>

## `pg_stat_activity` 뷰를 이용한 세션 모니터링
- 세션 레벨의 성능 정보를 제공하는 대표적인 뷰다
- 성능 모니터링 관점에서는 이 뷰 없이는 모니터링을 할 수 없다고 해도 과언이 아닐정도로 필수적임

<br>

### `pg_stat_activity` 뷰
- datname : 데이터베이스 이름을 식별하기 위한 컬럼
  - 대부분 stat 관련 정보는 인스턴스 단위에서 수집되므로 어떤 DB에서 조회해도 값이 동일함
  - 해당 컬럼을 통해서 DB를 식별할 수 있음
- pid : 백엔드 프로세스의 OS PID, OS 레벨에서 세션 추적시 유용함
- usename : 접속한 유저의 이름, 유저별 접속 통계를 낼 때 활용이 가능함
- application_name : 앱 이름으로 JDBC 기반 접속 여부를 식별하는 데 유용함
- client_addr : 클라이언트의 IP 주소로 WAS 서버별 접속 통계를 확인할 때 유용함
- xact_start : 트랜잭션 시작 시간
  - 트랜잭션 응답 시간을 파악할 때 매우 중요한 지표다
- query_start : 쿼리가 시작된 시간으로 쿼리 응답 시간을 측정할 수 있는 핵심 컬럼
- wait_event_type : 대기 이벤트 유형으로 병목 발생 위치를 대략적으로 파악이 가능함
- wait_event : 대기 이벤트로 병목이 바생한 구체적인 대기이벤트를 보여줌
- state : 세션의 상태
  - active, idle, idle in transaction 등 값이 존재
- backend_xmin : 쿼리 수행 시점의 XMIN 값
- query_id : 쿼리의 ID로 compute_query_id 파라미터를 on으로 설정해야 데이터가 제공됨
- query : 현재 수행중인 SQL 문장으로 실시간 모니터링에서 반드시 필요한 항목임

<br>

### extract (epoch from)
- 타임스탬프 형식을 초 단위로 변환하는 함수

```sql
postgres=# select extract (epoch from current_timestamp), current_timestamp;
      extract      |       current_timestamp       
-------------------+-------------------------------
 1762525376.086389 | 2025-11-07 14:22:56.086389+00
(1 row)
```

<br>

### pg_blocking_pids 함수
- 현재 세션을 블로킹하고 있는 세션의 PID를 제공함
