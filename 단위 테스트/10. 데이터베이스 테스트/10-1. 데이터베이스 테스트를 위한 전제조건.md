# 디비를 형상관리 시스템에 유지

- 첫번째 단계는 디비 스키마를 일반 코드로 취급하는것임
- 디비 스키마를 과거의 특정 시점으로 되돌릴 수 있어서 운영 환경에서 버그 재현에 유용함
- 형상관리와 실제 모델을 두개 다 관리하면 복수의 원천 정보로 인해 부담이 가중됨
- 이렇게 형상관리를 통해 스키마를 관리하는 경우는 외부에서는 디비 구조를 수정해서는 안됨

<br>

# 참조 데이터도 디비 스키마다

- 참조 데이터는 앱이 제대로 작동하도록 미리 채워야하는 데이터다
- 참조 데이터는 앱의 필수 사항이므로 다른 디비 자료들과 함께 SQL `INSERT` 형태로 같이 관리해야한다
- 일반 데이터와 구분하는 방법은 일반의 경우 앱에서 수정이 가능하지만 참조데이터는 앱에서 수정이 불가능하다

<br>

# 모든 개발자를 위한 별도의 디비 인스턴스

- 모든 개발자는 개발자마다 별도의 디비 인스턴스를 사용하는게 좋다
- 서로 다른 개발자가 실행한 테스트는 서로 간섭되어버린다
- 하위 호환성이 없는 변경으로 다른 개발자의 작업을 막을 수 있음

<br>

# 상태 기반 디비 배포와 마이그레이션 기반 디비 배포

### 상태 기반

- 개발 사이클 내내 유지보수하는 별도의 디비가 존재함
- 배포 중에 비교 도구가 스크립트를 생성해서 운영 디비를 모델 디비와 비교해 최신상태로 유지함
- 해당 방식에서 비교 도구는 운영 디비의 상태와 상관없이 모든 불필요 테이블을 삭제하고 컬럼명 변경 등 모델 디비와 동기화하는 데 필요한 모든 작업을 수행하게됨

<br>

### 마이그레이션 기반 방식

- 디비를 어떤 버전에서 다른 버전으로 전환하는 명시적인 마이그레이션을 의미함
- 동기화를 위한 자동화 도구 사용이 불가능하고 업그레이드 스크립트를 직접 작성해야함
- 해당 방식에서 형상 관리에 저장하는 산출물은 디비 상태가 아닌 마이그레이션 코드로 보통 SQL이다

<br>

### 상태 기반 방식보다 마이그레이션 기반 방식을 선호하기

- 마이그레이션 기반 방식은 데이터 모션 문제를 해결하는데 도움이 됨
  - 데이터 모션 문제는 새로운 디비 스키마를 준수하도록 기존 데이터의 형태를 변경하는 과정임
- 만약 Name 컬럼을 FirstName, LastName으로 분리할 때 상태 기반 방식은 이를 제어하는게 불가능함
  - 디비 스키마가 객관적이지만 데이터는 상황에 따라 달라짐
- 개발 초기단계에는 상태 기반 방식도 괜찮지만, 운영 릴리즈 이후에는 마이그레이션 기반 방식을 사용하는게 좋음

| 방식                   | 디비 상태 | 마이그레이션 매커니즘 |
| ---------------------- | --------- | --------------------- |
| 상태 기반 방식         | 명시적    | 암묵적                |
| 마이그레이션 기반 방식 | 암묵적    | 명시적                |
