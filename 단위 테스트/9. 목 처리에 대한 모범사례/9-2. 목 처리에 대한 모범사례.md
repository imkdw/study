# 목은 통합 테스트만을 위한것

- 도메인 모델은 단위테스트에 속하고, 컨트롤러는 통합테스트에 속한다
- 목은 비관리 의존성에만 해당하며 컨트롤러만 이러한 의존성을 처리하는 코드다
- 통합 테스트에서 컨트롤러를 테스트할 떄만 목을 적용해야한다

<br>

# 테스트당 목이 하나일 필요는 없음

- 단위라는 용어는 코드 단위가 아니라 동작 단위를 의미하며, 동작 단위를 구현하는데 필요한 코드의 양과는 싱관이 없다
- 동작 단위를 검증하는데 필요한 목의 수는 관계가 없다
- 목의 수는 운영에 참여하는 비관리 의존성 수에만 의존한다

<br>

# 호출 횟수 검증하기

- 비관리 의존성 통신에 대해서는 예상하는 호출이 있는지랑 예상치 못한 호출은 없는가를 체크해야한다
- 앱은 외부 시스템이 예상하는 메세지를 생략해서는 안되고 예상치 못한 메세지도 생성하면 안된다

```ts
// 1번만 호출했는지 목 검증
expect(storeMock.removeInventory).toHaveBeenCalledTimes(1);
```

<br>

# 보유 타입만 목으로 처리하기

- 서드파티 라이브러리 위에 항상 어댑터를 작성하고 기본 타입 대신 해당 어댑터를 목으로 처리해야한다는 지침이다
- 이유는 아래와 같다
  - 서드파티 코드 작동방식에 대해서 정확히 알지 못함
  - 코드가 이미 인터페이스를 제공해도 목으로 처리한 동작이 실제로 외부 라이브러리와 일치하는지 확인이 필요함
  - 서드파트 코드의 기술 세부 사항까지는 꼭 필요하지 않으므로 어댑터는 이를 추상화하고, 앱 관점에서 라이브러리와의 관계를 정의해야함
- 실제로 어댑터는 코드와 외부 환경 사이의 `손상 방지 계층`으로 작동함
