# 타입 선언과 관련된 세 가지 버전 이해하기

- 의존성관리는 개발자에게 매우 힘든 일임
- 하지만 TS는 이러한 의존성관리륻 더욱 힘들게 만듬
  - TS에서는 라이브러리 버전, 타입 버전, TS 버전 3가지를 모두 고려해야함
  - 위 3가지중에서 하나라도 맞지 않는다면 엉뚱한 오류가 발생할수도 있음
- 일반적으로 라이브러리 -> dependencies, 타입정보 -> devDependencies에 설치함

<br/>

### 라이브러리와 타입간 버전 불일치 문제

- 아래 에시에서는 타입과 실제 라이브러리의 정보가 다름
- semantic 버전 규칙을 준수한다면 괜찮지만 실수가 있을수도 있고 항상 괜찮다고 보장하긴 힘듬

```bash
npm i jest
npm i --save-dev jest
```

```json
"jest": "^29.7.0",
"@types/jest": "^29.5.12",
```

<br/>

### 실제 라이브러리와 타입을 따로 관리하면 발생할 수 있는 문제

#### 라이브러리를 업데이트 했지만 타입을 업데이트하지 않음

- 라이브러리의 신기능을 사용할 때 마다 오류가 발생할것임
- 하휘호환성이 깨지는 변경이 있다면 타입체커를 통과해도 런타임에 오류가 발생할 수 있음
- 만약 타입정보가 아직 준비되어있지 않다면 2가지 방법으로 해결이 가느함
  - 타입보강을 활용해서 오류 없애기
  - 최신 타입을 작성하여 커뮤니티에 기여하기

<br/>

#### 라이브러리보다 타입정보가 최신인 경우

- 두개의 버전이 일치하도록 업그레이드/다운그레이드를 진행

<br/>

#### 프로젝트에서 사용중인 TS 버전보다 라이브러리에서 쓰는 버전이 최신인 경우

- 일반적으로 유명한 라이브러리는 타입정보를 더 정확하게 표현하기 위해 계속 개선되고 버전이 올라감
- 프로젝트에서 사용중인 TS 버전을 올리거나 라이브러리의 버전을 낮춰야함
- `typesVersions`를 사용해서 버전별로 다른 타입선언 제공도 가능하지만 매우 드뭄

```bash
# 특정 TS 버전의 타입정보 설치하기
npm i --save-dev @types/lodash@ts3.1
```

<br/>

#### @types 의존성 중복

- npm은 현재 프로젝트에 설치된 버전과 외부 라이브러리의 버전이 불일치하는 경우 중첩된 폴더로 별도의 버전을 설치해서 이런 문제를 해결함
- 만약 전역 모듈로 사용중인 경우는 중복될 수 없다는 오류가 발생함
- 보통은 @types/foo를 업데이트 하거나 @types/bar를 업데이트해서 버전이 호환되도록 하는게 좋음

```bash
node_modules/
  @types/
    foo/
      index.d.ts@1.2.3
    bar
      index.d.ts
        node_modules/
          @types/
            foo/
              index.d.ts@2.3.4
```

<br/>

# 라이브러리에 타입을 정의하고 배포할때 발생할 수 있는 문제들

- 보통 자체적인 타입선언은 package.json 내부 types 필드에서 index.d.ts 를 가르키게됨
- 번들링하여 타입선언 파일을 포함하는 경우는 이러한 문제를 해결하지만 번들링에는 4가지 문제점이 존재함

<br/>

### 타입보강 또는 TS 버전 업그레이드로 인한 문제

- @types를 별도로 사용하는 경우는 라이브러리 버전에 맞춰서 선택이 가능함
- 번들된 타입에서는 버전 선택이 불가능함. 단 하나의 잘못된 타입선언으로 인해 TS 버전을 업그레이드를 못할수도 있음
- DefinitelyTyped의 경우 TS 버전이 올라감에 따라서 모든 타입들을 점검하고 빠른시간내에 해결해주고 있음

<br/>

### 프로젝트 내부 타입이 외부 라이브러리에 의존하는 경우

- 보통 타입설정은 devDependencies에 포함됨
- 하지만 다른 유저가 라이브러리를 받아서 설치하면 devDependencies 내부 패키지는 설치되지 않아서 에러가 발생함
  - 또한 JS 사용자의 경우 타입 정의를 설치할 필요가 없음

<br/>

### 과거 버전에 문제가 있는 경우 과거 버전으로 돌아가서 패치 업데이트를 해야함

- DefinitelyTyped는 버전별로 타입을 가지고 있어서 어느정도 해결이 가능함

<br/>

### 타입 선언의 패치업데이트를 자주하기 힘듬

- DefinitelyTyped의 경우는 커뮤니티에서 관리하기 때문에 아무래도 자주 업데이트가 발생함
- 하지만 개인이 관리하는 경우 직접 해야하기 때문에 비슷한 처리시간 보장이 힘듬

<br/>

# 공식 권장사항

- 라이브러리가 TS로 작성된 경우만 타입 선언을 라이브러리 내부에 포함하는것
  - 컴파일러가 뽑아주기때문에 쉽게 유지보수가 가능함
- JS로 작성된 라이브러리는 타입을 DefinitleyTyped에 공개하여 커뮤니티에서 관리하기
