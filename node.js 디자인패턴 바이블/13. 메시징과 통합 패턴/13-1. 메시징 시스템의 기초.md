# 메세징과 통합 패턴

- 확장성이 시스템 배포에 관한것이라면 통합은 시스템들을 연결하는것임
- 분산앱을 통합하는 방법에는 2가지가 존재함
  - 공유 스토리지를 중앙의 중재자와 정보관리자로 사용
  - 메세지를 사용하여 시스템 노드들에게 데이터, 이벤트 및 명령을 전파
- 분산 아키텍처에서는 메시징 시스템이라는 용어를 네트워크를 통한 정뵤 교환을 용이하게 하는 솔루션을 칭할때 사용함

<br/>

# 단방향 vs 요청/응답 패턴

- 단방향 패턴
  - 메세지가 소스에서 대상으로 한 방향으로 푸시되는 것
  - 예로는 웹소켓을 통한 브라우저에게 메세지를 보내는것
- 요청/응답 패턴
  - 메세지가 항상 반대 방향의 메시지와 한 쌍을 이루는 패턴
  - 웹 서비스를 호출하거나 DB에 쿼리를 보내는것
  - 여러개의 노드를 포함하는 패턴에서는 구현이 복잡해짐

<br/>

# 메세지 유형

### 명령 메세지

- 본질적으로 직렬화된 명령 객체
- 수신자에서의 작업 또는 작업의 실행을 트리거할때 사용함
- 일반적으로 작업의 이름과 인자의 목록이 포함되고 RPC 같은 시스템에서 사용

<br/>

### 이벤트 메세지

- 무엇인가 발생했음을 다른 컴포넌트에 알리는데 사용함
- 분산 앱에서 매우 중요한 메커니즘임

<br/>

### 문서 메세지

- 주로 컴포넌트와 머신들 사이에 데이터 전송을 위한 것

<br/>

# 비동기 메시징, 큐 및 스트림

- 동기식 통신
  - 전화통화랑 유사
  - 두개의 피어는 동시에 동일한 채널에 연결되어야 하고 실시간으로 메세지를 교환함
- 비동기식 통신
  - SMS와 유사
  - 발송하는 순간 수신자는 네트워크 연결이 없어도 되고, 즉시 또는 일정시간후에 받거나 아예 못받을수도 있음
  - 더 적은 리소스를 사용해서 병렬처리가 가능
  - 메세지를 저장하고 가능한 빠르게 또는 나중에 전달이 가능함
  - 메세지 대기열을 통해서 생성사/소비자 간 메세지를 주고 받을수있게 해줌
- 큐
  - 큐는 메세지가 검색되거나 처리될때 메세지를 제거함
  - 일반적으로 소비자에게 한번의 1개의 메세지만 제공
- 스트림
  - 검색되거나 처리될 떄 제거되지 않음
  - 메세지에 엑세스시 더 많은 자유를 제공

<br/>

# 피어 투 피어 또는 중개자 기반의 메세징

- 피어 투 피어
  - 모든 노드는 수신자에게 메세지를 전달할 책임이 있음
  - 브로커와 달리 단일 장애 지점이 없음
  - 중개자가 없으므로 대기 시간이 줄어듬
- 중개자 기반
  - 중앙에 메세지 브로커를 통해서 메세지를 전달함
  - MQTT, STOMP 등 다양한 메세징 프로토콜을 사용할 수 있음
