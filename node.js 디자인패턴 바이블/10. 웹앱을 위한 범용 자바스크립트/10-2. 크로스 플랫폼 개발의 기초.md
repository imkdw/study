# 런타임 코드 분기

- 플랫폼별로 같은 코드를 쓰다보면 코드 분기 및 모듈 스와핑과 같은 문제가 생김
- 이럴때는 런타임에 호스트 플랫폼을 인식해서 if...else로 분기처리하는 로직이 있어야함

```ts
function sayHello(name: string) {
  if (typeof window === "undefined" && window.document) {
    // client side codes
  }

  // Node.js code
}
```

<br/>

### 런타임 코드 분기의 문제점

- 사용되지 않는 불필요한 코드를 추가시켜서 번들의 크기가 증가함
- 호환성을 위한 코드가 비즈니스 로직과 섞여서 가독성 저하가 발생함
- 다행히 동적 임포트 모듈은 번들에 포함되지 않음

<br/>

### 빌드 시 코드 분기

- Webpack에선 DefinePlugin, terser-webpack-plugin 등 활용이 가능함
- 미사용 코드를 압축하고 코드 축소, 최적화 등을 사용할 수 있음

<br/>

### 모듈 스와핑

- 대부분의 경우 클라이언트 번들에 포함되어야할 코드와 안할 코드를 이미 알고있음
- Webpack.DefindPlugin을 사용하면 사전에 정의해서 모듈 스와핑이 가능함

<br/>

### 크로스 플랫폼 개발을 위한 디자인 패턴

- 전략 및 템플릿
  - 알고리즘의 공통 단계를 정의해서 일부 부분을 교체할 수 있도록함
  - 컴포넌트의 플랫폼에 구애받지 않는 부분을 공유할 수 있고 다른 전략을 사용해서 플랫폼에 따른 부분변경도 가능함
- 어댑터
  - 전체 컴포넌트를 교체해야 할 때 가장 유용함
  - 예를 들면 브라우저의 경우 기존 서버에서 쓰던 SQLite를 사용하는 부분을 브라우저용으로 대체하는 느낌
- 프록시
  - fs을 사용해야할때 프록시를 사용해서 내부를 서버에 웹소켓, Ajax 등으로 대체할 수 있음
