# SerpAPI를 정보 검색에 활용
- SerpAPI는 구글 검색을 포함한 다양한 검색 엔진을 통합해서 검색할 수 있도록 지원함
- 구글 검색뿐만 아니라 다양한 웹 검색, 쇼핑 검색 등도 사용이 가능함

<br>

### SerpAPI 예제
```python
from dotenv import load_dotenv
from langchain_community.utilities import SerpAPIWrapper

load_dotenv()

params = {"engine": "google", "gl": "kr", "hl": "ko", "num": 3}
search = SerpAPIWrapper(params=params)

# 구글 검색결과
# [
#     "《메이플스토리》는 넥슨 코리아에서 제작하고 넥슨 코리아가 서비스하는 세계 최초의 2D 사이드 스크롤 방식 온라인 MMORPG 게임이다. 전 세계 9개국 이상에서 서비스 되고 있으며, 약 13억 명 이상의 사용자가 가입되어 있다.",
#     "메이플스토리 type: 온라인게임.",
#     "메이플스토리 entity_type: video_games.",
#     "메이플스토리 kgmid: /m/04h2l3.",
#     "메이플스토리 개발: 넥슨, 위젯 스튜디오, 넥슨 코리아, 감마니아.",
#     "메이플스토리 출시: 넥슨, 감마니아, 샨다, Nexon America Inc..",
#     "메이플스토리 플랫폼: 지포스 나우, 마이크로소프트 윈도우.",
#     "메이플스토리 각색: 메이플스토리 (2007년).",
#     "메이플스토리 장르: 대규모 다중 사용자 온라인 롤플레잉 게임, 어드벤처 게임.",
#     "메이플스토리 시리즈: 메이플스토리.",
#     "메이플스토리 최초_출시일: 2005년 5월 11일.",
#     "서비스. 내정보 · MY결제 · 보안센터 · 넥슨플레이 · 넥슨플러그 · 넥슨링크 · 넥슨실험실 · 넥슨현대카드 · 크리에이터즈 · 넥슨에센셜 · 넥슨OPENAPI · 이벤트&공지.",
#     "2025년 현재 크레이지 파크, 블루 아카이브, FC 온라인, 던전앤파이터와 더불어 넥슨이 주력으로 밀고 있는 온라인 게임이며, 한국 온라인 게임의 태동기 ...",
#     "모든 MapleStory를 만나는 시간.",
# ]
print(search.run("메이플스토리"))

# 특정 웹사이트 내에서 키워드의 검색 결과
# [
#     "메수라이브. 메이플스토리에 도움이 되는 정보를 제공하는 서드파티 웹 앱입니다. Tools. React Next.js NextUI Tailwind CSS Prisma. 개발 환경. Node ...",
#     "메이플스토리의 다양한 최신 소식을 간편하게 확인할 수 있는 카카오톡 챗봇 (2024-07-21 ~ 2024-08-08) - wingunkh/MapleStory-Chatbot.",
#     "메이플스토리 마이크로사이트 · PROJECT : 메이플스토리 마이크로사이트 구축 · PERIOD : 2010. 03. 22 ~ 2010. 03. 26 · PROPOTION : 100% · TYPE : new · COMMENT. 게임소개 ...",
# ]
print(search.run("메이플스토리 site: github.com"))
```

<br>

### 이메일 요약에 써먹기
```python
from dotenv import load_dotenv
from pydantic import BaseModel, Field
from langchain_openai import ChatOpenAI
from langchain_core.output_parsers import PydanticOutputParser
from langchain_core.prompts import PromptTemplate
from langchain_community.utilities import SerpAPIWrapper

load_dotenv()


email_conversation = """From: 테디 (teddy@teddynote.com)
To: 이은채 대리님 (eunchae@teddyinternational.me)
Subject: RAG 솔루션 시연 관련 미팅 제안

안녕하세요, 이은채 대리님,

저는 테디노트의 테디입니다. 최근 귀사에서 AI를 활용한 혁신적인 솔루션을 모색 중이라는 소식을 들었습니다. 테디노트는 AI 및 RAG 솔루션 분야에서 다양한 경험과 노하우를 가진 기업으로, 귀사의 요구에 맞는 최적의 솔루션을 제공할 수 있다고 자부합니다.

저희 테디노트의 RAG 솔루션은 귀사의 데이터 활용을 극대화하고, 실시간으로 정확한 정보 제공을 통해 비즈니스 의사결정을 지원하는 데 탁월한 성능을 보입니다. 이 솔루션은 특히 다양한 산업에서의 성공적인 적용 사례를 통해 그 효과를 입증하였습니다.

귀사와의 협력 가능성을 논의하고, 저희 RAG 솔루션의 구체적인 기능과 적용 방안을 시연하기 위해 미팅을 제안드립니다. 다음 주 목요일(7월 18일) 오전 10시에 귀사 사무실에서 만나 뵐 수 있을까요?

미팅 시간을 조율하기 어려우시다면, 편하신 다른 일정을 알려주시면 감사하겠습니다. 이은채 대리님과의 소중한 만남을 통해 상호 발전적인 논의가 이루어지길 기대합니다.

감사합니다.

테디
테디노트 AI 솔루션팀"""


class EmailSummary(BaseModel):
    person: str = Field(description="메일을 보낸 사람")
    company: str = Field(description="메일을 보낸 사람의 회사 정보")
    email: str = Field(description="메일을 보낸 사람의 이메일 주소")
    subject: str = Field(description="메일 제목")
    summary: str = Field(description="메일 본문을 요약한 텍스트")
    date: str = Field(description="메일 본문에 언급된 미팅 날짜와 시간")


llm = ChatOpenAI(temperature=0, model_name="gpt-4o")

output_parser = PydanticOutputParser(pydantic_object=EmailSummary)

prompt = PromptTemplate.from_template(
    """
You are a helpful assistant. Please answer the following questions in KOREAN.

#QUESTION:
다음의 이메일 내용 중에서 주요 내용을 추출해 주세요.

#EMAIL CONVERSATION:
{email_conversation}

#FORMAT:
{format}
"""
)

prompt = prompt.partial(format=output_parser.get_format_instructions())

chain = prompt | llm | output_parser

answer = chain.invoke({"email_conversation": email_conversation})

params = {"engine": "google", "gl": "kr", "hl": "ko", "num": 3}

search = SerpAPIWrapper(params=params)

query = f"{answer.person} {answer.company} {answer.email}"

# 기본적으로 search.run() 함수는 문자열로 반환하는데 eval을 통해서 리스트로 변환이 가능함
search_result = eval(search.run(query))

# [
#     '테디노트 X 패스트캠퍼스 "RAG 비법노트" · 환경 설정 (Mac) · 환경 설정 (Windows) ... Teddy Lee (이경록). YouTube 테디노트 · 블로그 테디노트 · LinkedIn. LangChain.',
#     "문서 관리를 위한 메타데이터 태깅은 필수적이지만 번거로울 수 있습니다. OpenAI 기반의 자동화된 메타데이터 태깅 방법을 통해 이 과정을 효율적으로 만드는 방법을 알아 ...",
#     "데이터 분석, 머신러닝, 딥러닝, LLM 에 대한 내용을 다룹니다. 연구보다는 개발에 관심이 많습니다 \u200d♂️ ...more 데이터 분석, 머신러닝, 딥러닝, LLM 에 대한 내용을 ...",
# ]
print(search_result)

# <class 'list'>
print(type(search_result))
```