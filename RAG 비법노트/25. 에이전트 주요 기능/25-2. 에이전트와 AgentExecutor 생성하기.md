# 에이전트와 AgentExecutor 생성하기
- AgentExecutor는 복잡한 에이전트 구조를 단순화한 접근 방식임
- `bind_tools`를 통해서 직접 도구를 바인딩하는게 아닌 모델이 스스로 도구 사용이 필요한 시점을 감지하고 적절한 입력값을 전달할 수 있는 방식임
- 여기에는 단순히 모델이 도구를 제공해 주는 것뿐만 아니라 `순환`의 개념도 포함됨
- `Thought` 단계에서 어떤 도구를 사용할지 판단, `Action` 단계에서 웹 검색을 실행하고 도구를 호출함
- 도구 호출 결과를 `Observation`에 담고 유용하다고 판단하면 답변을 생성하지만 별로면 `Thought`로 돌아가서 재작업함
- 단순 `invoke` 메소드 접근이 아닌 `AgentExecutor` 사용이 필요함

```python
from langchain.tools import tool
from typing import List, Dict, Annotated
from langchain_teddynote.tools import GoogleNews
from langchain_experimental.utilities import PythonREPL
from langchain_openai import ChatOpenAI
from langchain.agents import create_tool_calling_agent
from langchain.agents import AgentExecutor
from langchain_core.prompts import ChatPromptTemplate


@tool
def search_news(query: str) -> List[Dict[str, str]]:
    """Search Google News by input keyword"""
    news_tool = GoogleNews()
    return news_tool.search_by_keyword(query, k=5)


@tool
def python_repl_tool(
    code: Annotated[str, "The python code to execute to generate your chart."],
):
    """Use this to execute python code. If you want to see the output of a value,
    you should print it out with `print(...)`. This is visible to the user."""
    result = ""
    try:
        result = PythonREPL().run(code)
    except BaseException as e:
        print(f"Failed to execute. Error: {repr(e)}")
    finally:
        return result


tools = [search_news, python_repl_tool]

prompt = ChatPromptTemplate.from_messages(
    [
        (
            "system",
            "You are a helpful assistant. "
            # 도구의 이름과 역할을 입력
            "Make sure to use the `search_news` tool for searching keyword related news.",
        ),
        ("placeholder", "{chat_history}"),
        ("human", "{input}"),
        ("placeholder", "{agent_scratchpad}"),
    ]
)

llm = ChatOpenAI(model="gpt-4o-mini", temperature=0)
agent = create_tool_calling_agent(llm, tools, prompt)

agent_executor = AgentExecutor(
    agent=agent,
    # 도구 목록 재공
    tools=tools,
    verbose=True,
    # 최대 단계 수
    max_iterations=10,
    # 소요될 수 있는 최대 초 단위 시간
    max_execution_time=10,
    # 출력 파서에서 발생한 오류 처리 방법, True의 경우 예외를 발생시키지 않고 자동으로 무시하고 계속 진행
    # False로 하면 즉시 예외를 발생시키는데, 여기서 오류 처리에 대한 사용자 정의 오류 처리 함수 설정도 가능함
    handle_parsing_errors=True,
)

result = agent_executor.invoke({"input": "AI 투자와 관련된 뉴스를 검색해 주세요."})

# > Finished chain.
# Agent 실행 결과:
# 다음은 AI 투자와 관련된 최근 뉴스입니다:

# 1. [불붙은 AI 투자경쟁…스타트업이 VC 골라 투자 받기도 - 한국경제](https://news.google.com/rss/articles/CBMiWkFVX3lxTE9DWlRUZDE1SnM1a2x2c2VnUmdpM2ZXSVNzVmdVc2V3b3VZc09UM1lfZUhDRGRQT2sxREFqMWY5Zk5nSFRDYm1UNE9MOHhfcDE0RTVua1V1alp3d9IBVEFVX3lxTE5lbzZ3R2dianlwZUFQdFg0em9FZnkwMWR4MFhreGlPZXdpQ2plSk9QRVA1emlyR1I0a3NobURIdm9tMHdGb0pIdGo4d1k2SS15TWJmVw?oc=5)

# 2. [손정의, 소뱅 AI 투자로 재산 급증…8월에만 90억달러 추가 - 블로터](https://news.google.com/rss/articles/CBMiaEFVX3lxTFBJb2hjMEdRNEZQR05ZV2NSUUxEWFp6MVVaRUl2N1FRNHdEVzhZLVh2S20wdEU4dC0wdHpoMWZHU2ZYZE5kLXRWVm9OVXZGOThtV2YyUzRtbHh5QWRnemw1YTJCaU1GZkpS0gFsQVVfeXFMTzctMFJxbFhwV0FybTV4a3RpSWlOemo0TmV2NzVfS19kaGJXcHJTR2dLTHFWbFBXSFh3N2E0bHBBZFJGZ3FEU3hxdl9qLVJreXp4MmliNV9iVk9fMTNuTkxXa2laNUowWTRFVHRi?oc=5)

# 3. [코히어, 5억 달러 투자 유치···기업용 AI 시장 확대 - 전자신문](https://news.google.com/rss/articles/CBMiTkFVX3lxTFBoWkJRX3g0YUJBaXBpSXNNa3VmLXJYU3RWeFNLZkR1enRRQVYwNGhUWFpMNkZTbExOaHZVcDJYc2VZTEdwZzUzMXNVV1NXdw?oc=5)

# 4. [AI '삼매경'에 빠진 증권가, 광고 애니메이션 투자상담 넘치는 활용법 - 비즈니스포스트](https://news.google.com/rss/articles/CBMic0FVX3lxTE1QWDN6N2VhbmlHMGE5WXg2T2V2ZTl6ZWJjXzVjci1nMmluNkpYbmFEWUhnQzJzendLS1hSY0R6VmdMcF82ZEY1NmtwTkJydFhtd1hTVEZhdGtUZHlMY0c5aDVqbWlPUlJKTFVGS09oLXI2YkE?oc=5)

# 5. [내년 상장 계획이었던 AI기업, 대표이사가 횡령 후 해외 도주... 투자사들 충격 - 조선비즈](https://news.google.com/rss/articles/CBMiiAFBVV95cUxNaVV6ZFhhLU1mR2RjWHVOYVJDb1E2WXJIOFFXbHBaOTF3TDVBeTcyUjBQdWZpV25DbHFrT0pYdEFfWm5vZm9IVDc1eXg0WUk3RTcxTFlLaUlocVdmYWdNZUdwWm40YXoydkZYbjliaWRKbml0MTFmYmhnWHd6U29DUm9BT2puTlZV0gGcAUFVX3lxTE4zTWlyUi1VZXdBOVFDeDFqd2hIUUhBWVFQRmlTcEE3WVRVQ1RMeVRsUGNUNFUxdEZXaGtTMXhBX0pWcnZVMGYyYzdacy1DVmR6dV9LQmRaQnBCLWJqRUVVZjhQeE83MjdtdnJraDFmOU8zRHBjWUdiM0VDOFZXLUhVTUxUNlBMQ2dfUnQ2YVM4NTcwRW5ReGdmd0duNQ?oc=5)

# 이 뉴스들은 AI 투자와 관련된 다양한 주제를 다루고 있습니다.
print("Agent 실행 결과:")
print(result["output"])
```