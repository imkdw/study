# 배치 함수로 일괄 처리하기
- Runnable은 랭체인에서 다양한 컴포넌트를 연결하고 실행하는 방식을 표준화한 공통 인터페이스
- Runnable 프로토콜을 사용하면 사용자 정의 체인을 쉽게 만들 수 있음
- 대부분의 컴포넌트에 구현되어 있으며 표준화된 인터페이스를 제공해 사용자의 요구에 맞게 체인을 호출할 수 있음

<br>

### 표준 인터페이스 종류
- stream(): 응답의 청크를 스트리밍
- invoke(): 입력에 대해 체인을 호출
- batch(): 여러 작업을 그룹으로 묶어서 일괄 처리하는 방식, 딕셔너리로 이루어진 리스트를 인자로 받아서 각 딕셔너리에서 특정 키 값으로 사용

<br>

### 배치처리 예제
```python
from dotenv import load_dotenv
from langchain_teddynote import logging
from langchain_openai import ChatOpenAI
from langchain_core.prompts import PromptTemplate
from langchain_core.output_parsers import StrOutputParser


load_dotenv()

logging.langsmith("langchain_test")

model = ChatOpenAI(model="gpt-4o-mini")

prompt = PromptTemplate.from_template("{topic}에 대해서 3문장으로 설명해줘")

chain = prompt | model | StrOutputParser()

# max_concurrency 옵션으로 처리량 조절 가능
answer = chain.batch(
    [{"topic": "ChatGPT"}, {"topic": "Instagram"}, {"topic": "Python"}],
    max_concurrency=2,
)

# [
#     "ChatGPT는 OpenAI에서 개발한 인공지능 언어 모델로, 자연어 처리를 통해 인간과의 대화가 가능합니다. 이 모델은 다양한 주제에 대해 질문에 답하거나 정보를 제공하며, 사용자의 입력에 기반해 자연스러운 대화 흐름을 유지합니다. 또한, ChatGPT는 학습된 데이터를 통해 지속적으로 개선되며, 다양한 언어와 상황에 적응할 수 있는 능력을 가지고 있습니다.",
#     "인스타그램(Instagram)은 사용자들이 사진과 동영상을 공유하고 소통할 수 있는 소셜 미디어 플랫폼입니다. 사용자는 다양한 필터와 편집 도구를 이용해 콘텐츠를 꾸밀 수 있으며, 해시태그를 통해 관심 있는 주제를 탐색할 수 있습니다. Instagram은 개인 사용자뿐만 아니라 브랜드 및 기업에게도 마케팅과 소비자와의 소통을 위한 중요한 도구로 활용되고 있습니다.",
#     "파이썬(Python)은 매력적인 문법과 강력한 기능을 가진 고급 프로그래밍 언어로, 코드의 가독성이 뛰어납니다. 다양한 라이브러리와 프레임워크를 제공하여 웹 개발, 데이터 분석, 인공지능 등 여러 분야에서 널리 사용됩니다. 크로스 플랫폼 지원 덕분에 Windows, macOS, Linux 등 다양한 운영체제에서 실행 가능하여 많은 개발자들에게 사랑받고 있습니다.",
# ]
print(answer)
```