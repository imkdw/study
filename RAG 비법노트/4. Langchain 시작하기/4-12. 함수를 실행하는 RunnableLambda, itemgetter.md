# RunnableLambda
- 사용자 정의 함수를 매핑해서 프롬프트를 입력하기 전에 실행, 그 결과를 프롬프트에 전달하는 Runnable 객체
- 파이썬으로 구현한 로직이나 외부 API 호출 등을 함수로 감싸서 먼저 실행하고 그 결과값을 프롬프트에 전달이 가능함
```python
from dotenv import load_dotenv
from langchain_teddynote import logging
from langchain_openai import ChatOpenAI
from langchain_core.prompts import PromptTemplate
from langchain_core.output_parsers import StrOutputParser
from langchain_core.runnables import RunnableLambda, RunnablePassthrough
from datetime import datetime


load_dotenv()

logging.langsmith("langchain_test")

prompt = PromptTemplate.from_template("{num}의 10배는?")
llm = ChatOpenAI(model="gpt-4o-mini")


def get_today(a):
    return datetime.today().strftime("%b-%d")


prompt = PromptTemplate.from_template(
    "{today} 가 생일인 유명인 {n} 명을 나열하세요. 생년월일을 표기해 주세요."
)
llm = ChatOpenAI(temperature=0, model_name="gpt-4.1-mini")

# chain 을 생성합니다.
chain = (
    {"today": RunnableLambda(get_today), "n": RunnablePassthrough()}
    | prompt
    | llm
    | StrOutputParser()
)

"""
다음은 7월 31일이 생일인 유명인 3명입니다:

1. J.K. 롤링 (J.K. Rowling) - 1965년 7월 31일  
2. 해리슨 포드 (Harrison Ford) - 1942년 7월 31일  
3. 조니 웨스트 (Johnny West) - 1934년 7월 31일  
"""
print(chain.invoke(3))
```

<br>

# itemgetter
- 딕셔너리에서 특정 키에 해당하는 값을 추출함
  
```python
from dotenv import load_dotenv
from langchain_teddynote import logging
from langchain_openai import ChatOpenAI
from langchain_core.prompts import PromptTemplate
from langchain_core.output_parsers import StrOutputParser
from langchain_core.runnables import RunnableLambda, RunnablePassthrough
from datetime import datetime


load_dotenv()

logging.langsmith("langchain_test")

from operator import itemgetter

from langchain_core.prompts import ChatPromptTemplate
from langchain_core.runnables import RunnableLambda
from langchain_openai import ChatOpenAI


def length_function(text):
    return len(text)


def _multiple_length_function(text1, text2):
    return len(text1) * len(text2)


def multiple_length_function(_dict):
    return _multiple_length_function(_dict["text1"], _dict["text2"])


prompt = ChatPromptTemplate.from_template("{a} + {b} 는 무엇인가요?")
model = ChatOpenAI()


chain = (
    {
        # word1을 추출하고, 해당 값을 length_function 함수에 전달하여 a 프로퍼티에 전달
        # word1은 hello 이므로 5가 전달됨
        "a": itemgetter("word1") | RunnableLambda(length_function),
        # b는 각 단어를 가져오고 2개의 단어의 길이 곱해서 전달
        # word1 hello 이므로 5, word2는 word 이므로 5, 즉 25가 b의 값으로 전달됨
        "b": {"text1": itemgetter("word1"), "text2": itemgetter("word2")}
        | RunnableLambda(multiple_length_function),
    }
    | prompt
    | model
    | StrOutputParser()
)

# 5 + 25 = 30입니다.
print(chain.invoke({"word1": "hello", "word2": "world"}))
```