# 문서 로더의 구조 이해하기
- RAG 시스템의 8단계 중 첫번째 단계로 `문서`를 `디비`에 불러오는 역할을 담당함
- 랭체인은 다양한 로더들과 통합이 잘 이루어져 있고 여러 형식의 문서를 간단히 처리가 가능함

<br>

# document 객체
- 랭체인의 기본 문서 객체로, 다양한 파일을 불러오면 document 객체로 변환됨
- `page_conent`에는 문서의 텍스트가 들어있고, `metadata`에는 문서와 관련된 속성값을 담고 있음

```python
from langchain_core.documents import Document

document = Document(page_content="Hello, This is Maplestory Guidebook")

# {
#     "id": None,
#     "metadata": {},
#     "page_content": "Hello, This is Maplestory Guidebook",
#     "type": "Document",
# }
print(document.__dict__)

# 메타데이터 추가
document.metadata["source"] = "Maplestory"
document.metadata["page"] = 1
document.metadata["author"] = "Dongwoo"

# {"source": "Maplestory", "page": 1, "author": "Dongwoo"}
print(document.metadata)
```

<br>

# 문서 로더 사용해보기
- `문서 로더`는 여러가지 파일에서 불러온 내용을 `document` 객체로 변환하는 역할을 담당함
- 로더 종류는 `PyPDFLoader(PDF)`, `CSVLoader(CSV)` 등 다양하게 존재함
- 문서 로더에서 가장 많이 쓰이는 `load()` 메소드는 문서 전체 내용을 로드해서 반환함

```python
from langchain_community.document_loaders import PyPDFLoader

FILE_PATH = (
    "/Users/imkdw/study/RAG 비법노트/example/maplestory-black-magition-pattern.pdf"
)

# 로더 설정
loader = PyPDFLoader(FILE_PATH)

# PDF 로더
docs = loader.load()

# 39
print(len(docs), end="\n\n")

# page_content=' [편집]
# 1, 2, 3페이즈에서 운석이 수직으로 떨어진다. 맵 기준으로 오른쪽 위에서부터 왼쪽으로, 또는 반대로 떨어지며, 인접한 운석 간
# 에는 135px, 0.65초의 간격이 있다. 피격 시 50% 데미지를 입고 창조의 저주에 걸린다. 다크 사이트 상태로 회피할 수 있다.
# 재사용 대기시간 약 60초
# 유저들 사이에서는 보통 감자, 회오리 감자라고 부른다. 2페이즈에서 마지막 운석은 중간에 터지며, 3페이즈에서 생성된 발판에
# 닿아도 터진다.
# 모닝 스타폴 (통칭 : 사선, 땅개)
# 떨어지는 모습 지면에 떨어진 후 이동하는 모습
# 2, 3페이즈에서 보라색 운석 5개가 왼쪽 아래 대각선 방향으로 떨어진다.[15] 피격 시 35% 데미지를 입고 창조의 저주에 걸린
# 다. 다크 사이트로 회피할 수 있다.
# 지상에 낙하 후에는 지상에서 왼쪽이나 오른쪽 중 랜덤한 방향으로 이동하며, 맵 끝까지 이동하여 충돌한 뒤 사라진다. 피격 시 5
# 0% 데미지를 입고 창조의 저주에 걸린다. 다크 사이트로 회피할 수 없다.
# 유저들 사이에서는 보통 공중에서 떨어지는 운석을 사선, 지상에서 움직이는 운석을 땅개라고 부른다. 이 운석은 대체로 왼쪽에
# 집중적으로 떨어지기에 왼쪽에 있으면 피하기가 굉장히 어렵다.
# 낙하 후 상태에선 텔레포트나 윗점을 사용해서 피할 수 있으나 녹스피어, 검은 사슬 같은 파괴의 저주 패턴에 맞지 않도록 주의할
# 것. 특히 2페이즈에서 최악의 패턴 중 하나인데 스타폴과 사슬, 폴링, 녹스피어 등과 함께 쏟아지는 경우가 많기 때문에 저주가
# 중첩될 경우 데스 카운트가 순식간에 사라진다.
# 2.2. 페이즈 1' metadata={'producer': 'Skia/PDF m138', 'creator': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36', 'creationdate': '2025-08-03T10:56:13+00:00', 'title': '검은 마법사/보스 몬스터/공격 패턴 - 나무위키', 'moddate': '2025-08-03T10:56:13+00:00', 'source': '/Users/imkdw/study/RAG 비법노트/example/maplestory-black-magition-pattern.pdf', 'total_pages': 39, 'page': 5, 'page_label': '6'}
print(docs[5])
```

<br>

# 문서 로딩하고 분할하기
```python
from langchain_text_splitters import RecursiveCharacterTextSplitter
from langchain_community.document_loaders import PyPDFLoader

# 청크 크기는 200으로 설정하고 겹치는 부분이 없도록 설정
text_splitter = RecursiveCharacterTextSplitter(chunk_size=200, chunk_overlap=0)

# 예제 파일 경로
FILE_PATH = (
    "/Users/imkdw/study/RAG 비법노트/example/maplestory-black-magition-pattern.pdf"
)

loader = PyPDFLoader(FILE_PATH)

split_docs = loader.load_and_split(text_splitter=text_splitter)

# 문서의 길이: 144
print(f"문서의 길이: {len(split_docs)}", end="\n\n")

# page_content='창조의 저주는 지속 시간 동안 초당 4%씩 체력과 마나가 회복되는 대신 최종 데미지가 10% 감소하며, 캐릭터의 위치에 가
# 끔씩 화염이 생성된다. 화염에 피격 시 20% 데미지를 입는다.
# 파괴의 저주
# 빛의 초월자의 권능 중 파괴의 힘으로 인한 저주. 최종 데미지가 증가하지만 피격 데미지가 증가하고 소모품을 사용' metadata={'producer': 'Skia/PDF m138', 'creator': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36', 'creationdate': '2025-08-03T10:56:13+00:00', 'title': '검은 마법사/보스 몬스터/공격 패턴 - 나무위키', 'moddate': '2025-08-03T10:56:13+00:00', 'source': '/Users/imkdw/study/RAG 비법노트/example/maplestory-black-magition-pattern.pdf', 'total_pages': 39, 'page': 2, 'page_label': '3'}
print(split_docs[10], end="\n\n")
```

<br>

# 페이지 별 데이터 하나씩 처리하기
```python
from langchain_text_splitters import RecursiveCharacterTextSplitter
from langchain_community.document_loaders import PyPDFLoader

text_splitter = RecursiveCharacterTextSplitter(chunk_size=200, chunk_overlap=0)

# 예제 파일 경로
FILE_PATH = (
    "/Users/imkdw/study/RAG 비법노트/example/maplestory-black-magition-pattern.pdf"
)

loader = PyPDFLoader(FILE_PATH)

# 제너레이터 방식으로 로딩
for doc in loader.lazy_load():
    print(doc.metadata)
```