# 임베딩으로 노래 추천하기
- 각각의 노래를 단어나 토큰으로 다루고 재생목록을 문장처럼 취급한다고 가정함
- 임베딩을 통해서 재생목록에 자주 함께 등장하는 비슷한 노래를 추천할 수 있음

<br>

# 노래 임베딩 모델 훈련하기
```python
import pandas as pd
import numpy as np
from urllib import request
from gensim.models import Word2Vec


def print_recommendations(song_id):
    similar_songs = np.array(
        model.wv.most_similar(positive=str(song_id), topn=5)
    )[:, 0]
    return songs_df.iloc[similar_songs]


# 재생목록 데이터셋 파일 로딩
data = request.urlopen('https://storage.googleapis.com/maps-premium/dataset/yes_complete/train.txt')

# 재생목록 파일을 파싱, 처음 두 줄은 메타데이터만 담고 있으므로 스킵함
lines = data.read().decode("utf-8").split('\n')[2:]

# 하나의 노래만 있는 재생목록은 삭제
playlists = [s.rstrip().split() for s in lines if len(s.split()) > 1]

# 노래의 메타데이터를 로딩
songs_file = request.urlopen('https://storage.googleapis.com/maps-premium/dataset/yes_complete/song_hash.txt')
songs_file = songs_file.read().decode("utf-8").split('\n')
songs = [s.rstrip().split('\t') for s in songs_file]
songs_df = pd.DataFrame(data=songs, columns=['id', 'title', 'artist'])
songs_df = songs_df.set_index('id')

"""
재생목록 #1:
  ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', '23', '24', '25', '26', '27', '28', '29', '30', '31', '32', '33', '34', '35', '36', '37', '38', '39', '40', '41', '2', '42', '43', '44', '45', '46', '47', '48', '20', '49', '8', '50', '51', '52', '53', '54', '55', '56', '57', '25', '58', '59', '60', '61', '62', '3', '63', '64', '65', '66', '46', '47', '67', '2', '48', '68', '69', '70', '57', '50', '71', '72', '53', '73', '25', '74', '59', '20', '46', '75', '76', '77', '59', '20', '43'] 

재생목록 #2:
  ['78', '79', '80', '3', '62', '81', '14', '82', '48', '83', '84', '17', '85', '86', '87', '88', '74', '89', '90', '91', '4', '73', '62', '92', '17', '53', '59', '93', '94', '51', '50', '27', '95', '48', '96', '97', '98', '99', '100', '57', '101', '102', '25', '103', '3', '104', '105', '106', '107', '47', '108', '109', '110', '111', '112', '113', '25', '63', '62', '114', '115', '84', '116', '117', '118', '119', '120', '121', '122', '123', '50', '70', '71', '124', '17', '85', '14', '82', '48', '125', '47', '46', '72', '53', '25', '73', '4', '126', '59', '74', '20', '43', '127', '128', '129', '13', '82', '48', '130', '131', '132', '133', '134', '135', '136', '137', '59', '46', '138', '43', '20', '139', '140', '73', '57', '70', '141', '3', '1', '74', '142', '143', '144', '145', '48', '13', '25', '146', '50', '147', '126', '59', '20', '148', '149', '150', '151', '152', '56', '153', '154', '155', '156', '157', '158', '159', '160', '161', '162', '163', '164', '165', '166', '167', '168', '169', '170', '171', '172', '173', '174', '175', '60', '176', '51', '177', '178', '179', '180', '181', '182', '183', '184', '185', '57', '186', '187', '188', '189', '190', '191', '46', '192', '193', '194', '195', '196', '197', '198', '25', '199', '200', '49', '201', '100', '202', '203', '204', '205', '206', '207', '32', '208', '209', '210']
"""
print('재생목록 #1:\n ', playlists[0], '\n')
print('재생목록 #2:\n ', playlists[1])

# Word2Vec 모델을 훈련시킴
model = Word2Vec(
    playlists, vector_size=32, window=20, negative=50, min_count=1, workers=4
)

# 타겟하는 노래 아이디
song_id = 2172

"""
[
    ('2849', 0.9982576966285706), 
    ('5586', 0.9971529841423035), 
    ('3167', 0.9969125390052795), 
    ('6624', 0.9965043067932129), 
    ('2976', 0.9960848093032837), 
    ('11473', 0.9948599338531494), 
    ('10105', 0.9947023391723633), 
    ('6658', 0.9946550130844116), 
    ('5634', 0.9944720268249512), 
    ('3094', 0.9944137930870056)
]

타켓 노래와 비슷한 노래를 찾으라고 모델에게 요청
"""
print(model.wv.most_similar(positive=str(song_id)))

"""
title     Fade To Black
artist        Metallica
Name: 2172 , dtype: object

원본 노래
"""
print(songs_df.iloc[song_id])

"""
추천 노래 목록 보기

id             title         artist
-------------------------------------
2849    Run To The Hills  Iron Maiden
11473     Little Guitars    Van Halen
10105     Three Lock Box  Sammy Hagar
3167           Unchained    Van Halen
3126         Heavy Metal  Sammy Hagar
"""
print(print_recommendations(song_id))
```