# 레디스의 pub, sub

- 레디스는 자체적으로 아주 간단한 pub/sub 패턴을 제공함
  - 매우 가볍기때문에 최소한의 메세지 전달기능만 제공해줌
- 발행자는 특정 채널에 메세지를 보내고, 구독자는 리스닝하다가 메세지를 읽을 수 있음
- 한번 전달된 데이터는 저장되지 않으니 중요한 정합성 데이터를 다룰때는 권장하지 않음
  - 앱에서 메시지 송수신 관련한 추가적인 로직 작성이 필요할수도 있음

<br/>

# 메세지 보내기

- PUBLISH 명령어로 메세지를 보낼 수 있음
- 메세지를 구독하고 있는 구독자의 수가 반환됨

```
127.0.0.1:6379> publish hello world
(integer) 1
127.0.0.1:6379>
```

<br/>

# 메세지 구독하기

- SUBSCRIBE 명령어로 메세지를 구독할 수 있음
- 이미 구독중인 상태에서 pub/sub와 관련되지 않은 다른 행동은 불가능함

```
127.0.0.1:6379> subscribe hello
1) "subscribe"
2) "hello"
3) (integer) 1
1) "message"
2) "hello"
3) "world"
Reading messages... (press Ctrl-C to quit or any key to type command)
```

또한 PSUBSCRIBE 명령어로 glob-style 패턴을 통해서 여러개의 채널을 동시에 구독할 수 있음

```
127.0.0.1:6379> PSUBSCRIBE mail-*
1) "psubscribe"
2) "mail-*"
3) (integer) 1
1) "pmessage"
2) "mail-*"
3) "mail-all"
4) "all mail"
```

<br/>

# 클러스터 구조에서 pub/sub

- 클러스터는 대규모 서비스에서 데이터를 분산해서 저장하고 처리하기 위해 도입됨
- 메시지를 발생하면 해당 클러스터에 속한 모든 노드에서 메세지 수신이 가능함
- 하지만 모든 노드에서 동일한 메세지가 복제되는건 클러스터 환경의 핵심 목표와 부합하지 않음
- 불필요한 리소스 사용과 네트워크 부하가 발생할 수 있음

<br/>

# shareded pub/sub

- 클러스터 환경의 비효율적인 방식을 해결하기 위해 7버전에서 도입됨
- 각 채널의 슬롯에 매핑되는 구조이며 같은 슬롯을 가진 노드에만 메세지가 전파됨
- SPUBLISH 명령어로 메세지를 보낼 수 있음
  - 모든 노드에 전파되지 않고, 노드의 복제본에만 전달됨
- SSUBSCRIBE 명령어로 메세지를 구독할 수 있음
