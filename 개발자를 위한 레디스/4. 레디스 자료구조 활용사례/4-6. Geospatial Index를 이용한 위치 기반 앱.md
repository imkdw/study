# 위치데이터

- 위치데이터는 매우 다양한 곳에 사용된다
  - 현재 위치를 파악하고 목적지까지 안내하기
  - 위치 기반으로 맞춤 광고 제공
- 위치데이터의 요구사항
  - 현재 위치 파악
  - 이동에 따른 실시간 변동 위치 업데이트
  - 위치를 기준으로 근처 장소 검색
- 보통 경도와 위도 쌍으로 표현함
- 단순 읽기/쓰기라 간단해보이지만 유저수의 비례해서 점점 부하가 발생

<br/>

# 레디스의 위치데이터

- geo 자료구조를 통해서 공간 정보 데이터를 처리할 수 있음
- RDB를 사용하는 경우 저장은 가능하지만, 실제 로직은 외부에서 처리해야함
- 레디스는 저장은 물론 실시간 위치연산도 제공해서 서비스의 빠른 응답속도를 보장해줌
- geo set + pub/sub를 결합해서 근처 사용자에게 실시간 알람제공 등 다양한 서비스 구현이 가능함

<br/>

### geo set

- 위치 공간 관리에 특화된 데이터 구조, 각 데이터는 경도/위도 쌍으로 저장
- 이미 존재하는 키에 한번더 getadd를 하는경우 업데이트 된다

```
<!-- 아이디가 142인 유저의 위치정보 저장 -->
127.0.0.1:6379> geoadd user 50.1231231231 14.1421312 142
(integer) 1

<!-- 업데이트 -->
127.0.0.1:6379> geoadd user 23.51312412 51.2141421312 142
(integer) 0
```

```
<!-- 한국 특정 위치에 레스토랑 등록 -->
127.0.0.1:6379> geoadd restaurant 50.1241312 13.1231231 korea
(integer) 1

<!-- 한국 레스토랑의 위치 조회 -->
127.0.0.1:6379> geopos restaurant korea
1) 1) "50.12413233518600464"
   2) "13.12312211861598144"

<!-- 현재 위치와 레스토랑이 10km 이내에 있는곳 검색 -->
127.0.0.1:6379> geosearch restaurant fromlonlat 50.123121 13.1231212312 byradius 10 km
1) "korea"
```
