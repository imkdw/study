# RDB 방식의 데이터 백업

- 레디스에서 데이터를 백업하는 가장 간단한 방법
- 장애가 발생했을 때 손실 가능성을 최소화해야하는 서비스에는 권장하지 않음

<br/>

# 특정 조건에 자동으로 RDB 생성

- redis.conf 파일 내부에 정의가 가능함

```
save <기간(초)> <변경된 키 개수>
dbfilename <파일명>
dir <RDB 파일 저장될 경로>
```

### save

- `save 900 1`
  - 900초(15분) 동안 1개 이상의 키가 변경된 경우
- `save ""`
  - RDB 생성 비활성화
- `CONFIG SET save ""` -> `CONFIG REWRITE`
  - 레디스가 실행중인 상태에서 RDB 생성 비활성화

<br/>

# 수동으로 RDB 생성

- SAVE, BGSAVE 명령어를 통해서 수동으로 RDB 파일을 생성할 수 있음
- LASTSAVE 명령어로 최근 RDB 생성 시간을 확인할 수 있음

### SAVE

- 동기방식으로 파일을 생성함
  - 컨피그가 생성중인 동안 다른 명령어 실행이 불가능함
  - 일반적인 운영 환경에서는 사용하지 않는것을 권장

```
127.0.0.1:6379> save
OK
127.0.0.1:6379>
```

### BGSAVE

- fork 호출을 통해서 자식 프로세스를 생성하고, 해당 프로세스가 RDB를 만듬
- 만약 이미 백그라운드로 데이터를 생성중일때는 에러가 발생하므로 SCHEDULE 커맨드랑 같이쓰는게 좋음

```
127.0.0.1:6379> bgsave
Background saving started
127.0.0.1:6379>
```

<br/>

# 복제를 사용하는 경우 자동으로 RDB 생성

- REPLICAOF 명령어를 사용해서 복제 요청시 마스터 노드에서 RDB를 생성후 복제본에 전달
- 네트워크 등 장애가 발생시에도 복제본으로 RDB를 전달
- 처음 복제 연결이나 이미 복제 연결이 된 상태에서도 언제든지 RDB를 생성할 수 있음
