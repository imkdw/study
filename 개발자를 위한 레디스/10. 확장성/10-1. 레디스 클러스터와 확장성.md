# 스케일업 vs 스케일아웃

### 스케일업

- 서버의 하드웨어의 사양을 올리는 방법, CPU/RAM 등을 높여서 처리량을 올림
- 서버 자체의 능력을 올리기때문에 수직 확장이라고 함
- 간단하지만 비용문제와 사양의 한계가 있음

### 스케일아웃

- 장비를 추가해서 시스템을 확장시키는 방법
- 기존 서버의 사양 업그레이드에는 한계점이 있음
- 비슷한 서버를 여러대 배치해서 용량과 처리량을 높임
- 서버 자체 능력을 올리는게 아니라 대수가 증가하므로 수평 확장이라고함
- 분산처리에 대한 로직이 추가로 개발되야함

<br/>

# 레디스에서의 확장성

- 레디스를 운영중에 이빅현(eviction)이 자주 발생하면 스케일 업을 고려할 수 있음
- 이빅션은 maxmemory가 꽉 찼을때 또 데이터를 추가할려고 하면 발생함
- 하지만 레디스가 단일스레드에서 동작하므로 CPU가 좋아도 다 활용이 불가능함

<br/>

# 레디스 클러스터의 기능

- 클러스터 모드로 사용하면 앱 아키텍처의 변경없이 레디스를 확장할 수 있음

### 데이터 샤딩

- 스케일아웃을 진행하면서 여러개의 서버 간 데이터를 분할하는걸 샤딩이라고 부름
- 레디스에서 클러스터 기능을 사용하면 마스터를 최대 1000개 까지 확장이 가능함
- 샤딩과 관련된 모든 기능은 레디스 내부에서 처리되고 별다른 아키텍쳐는 필요하지 않음
- 데이터는 키를 사용해서 샤딩되고, 하나의 키는 항상 마스터 노드에 매핑됨
- 클라이언트가 다른 노드에 데이터를 저장하거나 읽으면 자동으로 연결을 리디렉션해줌
- 클러스터에 노드가 추가/변경되지 않으면 키는 특정 마스터에 매핑되고 캐싱되서 성능이 개선됨

### 고가용성

- 최소 3대의 마스터, 복제본 노드를 갖도록 구성하는것이 일반적, 각 노드는 서로를 모니터링함
- 서로 모니터링 도중 장애 발생시 외부 개입없이 자동으로 페일오버가 진행되므로 가용성이 올라감
- 마스터에 연결된 복제본의 개수를 파악해서 잉여 복제본을 필요한 노드에 연결시키는 마이그레이션도 수행함

#### 클러스터 버스

- 클러스터 내부의 노드는 클러스터 버스라는 독립적인 통신을 사용
- 모든 노드는 다른 노드에서 들어오는 연결을 수신하기 위해 추가 TCP 포트가 열려있음
- cluster_bus_port를 수정하지 않으면 기본 포트에 +10000을 해서 16379가 됨
- full-mesh 토폴로지 형태로 모든 노드는 N-1개의 다른 노드와 TCP 연결을 맺음
- 1개의 노드로 헬스체크를 시도하고 응답이 이상하면 다른 노드로 시도하는 형식임
