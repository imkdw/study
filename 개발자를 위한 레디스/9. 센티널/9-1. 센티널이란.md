# 복제를 통한 레디스의 고가용성 확보

- 기존 복제를 사용하게 되면 마스터 노드 다운시 수동으로 복제본으로 트래픽을 이전해야함
- 마스터 노드의 장애 발생시 직접 대처해주지 않으면 장시간 서비스의 장애로 이어짐

<br/>

# 센티널이란?

- 데이터를 저장하는 기존 레디스 인스턴스와는 다른 별도의 역할을 하는 프로그램
- 센티널의 자동 페일오버 기능을 사용하면 다운타임을 최소화 할 수 있음

<br/>

# 센티널 기능

- 모니터링 : 마스터, 복제본 인스턴스의 상태를 실시간으로 확인
- 자동 페일오버 : 마스터의 상태감지를 통해서 정상적인 복제본에게 마스터로 승격시켜줌
- 인스턴스 구성정보 : 클라이언트에게 현재 마스터의 정보를 알려줌
  - 페일오버 발생시 마스터 정보도 같이 넘겨주므로 수동 페일오버를 하지 않아도 됨

<br/>

# 분산시스템으로 동작하는 센티널

- 센티널은 SPOF를 방지하기 위해 최소 3대 이상일 떄 정상적으로 작동할 수 있도록 설계됨
- 센티널은 오탐을 줄이기 위해서 쿼럼(Quorum) 개념을 사용함
  - 마스터가 비정상 동작을 한다는것에 동의해야된다는 센티널의 수
  - 만족하는 경우 페일오버를 진행함
  - 센티널이 3개일때 쿼럼은 2로 설정하게 되는데, 2개 이상의 센티널이 마스터가 비정상으로 동의하면 페일오버가 진행됨
  - 과반수 선출 개념을 사용하므로 3, 5 등 홀수로 구성하는게 좋음

<br/>

# 센티널 인스턴스 배치 방법

- 기본적으로 물리적으로 서로 영향받지 않는 서버에서 실행하는게 좋음
- 마스터 노드의 장애를 감지학 위해서 서로 다은 가용영역에 배치하는게 일반적임
- 만약 2개의 인스턴스만 있어도 충분하다면 나머지 1대의 서버에는 센티널만이라도 배치하는게 좋음
  - 클라이언트의 요청을 받지 않으니 최소한의 사양도 가능함
