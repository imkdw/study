# 시스템이 제공하는 기능

### 상태를 변경하는 기능

- 새로운 주문 생성, 배송지 정보 변경, 암호 변경 등이 이에 해당한다
- 개발자는 현재 저장하고 있는 데이털르 변경하는 방식으로 기능을 구현한다

<br>

### 조회하는 기능

- 주문 상세내역, 게시글 목록, 회원정보 등 이 이에 해당한다
- 조회 기능은 필요한 데이터를 읽어와서 UI를 통해서 보여주는 방식으로 구현하게된다

<br>

### 문제점

- 대부분 상태를 변경하는 범위와 상태를 조회하는 범위가 정확하게 일치하지 않는다
- 단일모델로 두 종류의 기능을 구현하게되면모델이 불필요하게 복잡해진다
- 이러한 단일 모델을 사용할 때 발생하는 복잡도를 해결하기 위해서 사용하는 방법이 바로 `CQRS`다

<br>

# CQRS

- Command Query Responsibility Segregation의 약자로 상태를 변경하는 `명령`을 위한 모델과 상태를 제공하는 `조회`를 위한 모델을 분리하는 패턴이다
- CQRS는 복잡한 도메인에 적합한데, 복잡할수록 명령 기능와 조회 기능이 다루는 데이터 범위에 차이가 발생한다

<br>

### 다른 저장공간 사용

- 명령의 경우에는 트랜잭션이 필요하므로 RDBMS를 사용하는게 좋다
- 조회의 경우에는 성능이 우선시되므로 NoSQL을 사용해도 된다

<br>

### 저장공간 동기화

- 이벤트를 통해서 두 데이터 저장소 간 데이터 동기화가 가능하다
- 명령 모델에서 상태를 변경하면 이에 해당하는 이벤트를 조회 모델에서 받아서 변경내역을 반영한다
- 변경 내역을 바로 조회 모델에 반영해야된다면 동기 이벤트와 글로벌 트랜잭션을 사용해서 실시간으로 동기화도 가능하다

<br>

# 웹과 CQRS

- 일반적인 웹 서비스의 경우는 상태를 변경하는 요청보다는 상태를 조회하는 요청이 많다
- 대부분의 많은 읽기 요청에 대한 최적화를 하기 위해서 캐싱을 도입하곤 한다
- 만약 조회속도를 높이기 위해서 별도의 처리를 하고있다면 명시적으로 명령 모델과 조회 모델을 구분하는게 좋다
- 복잡해지는것을 막을 수 있고 명령모델에 관계 없이 조회 기능에 특화된 구현 기법을 보다쉽게 적용이 가능하다

<br>

# CQRS 장단점

### 장점

- 명령모델을 구현할 때 도메인 자체에 집중할 수 있음
- 조회 성능을 위한 코드가 명령 모델에 없으므로 도메인 로직을 구현하는데 집중이 가능함
- 조회에 특화된 쿼리를 사용하거나 조회단위로 캐싱이 가능하므로 성능을 향샹시키는데 유리함

<br>

### 단점

- 각 모델이 따로 구현되므로 작성해야되는 코드가 더 많아짐
- 도메인이 단순하거나트래픽이 많지 않다면 조회 전용 모델을 따로 만들때 얻을 이점이 있는지 따져봐야함
- 저장소를 나누는 등 작업을 위해서는 이벤트, 동기화 등 더 많은 구현 기술이 필요함
- 도메인이 복잡하지 않는데 CQRS를 도입하려면 두 모델을 유지하는데 비용만 높아지고 얻을수 있는 이점이 없음
