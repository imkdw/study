# 이벤트 적용 시 추가 고려 사항

### EventSource를 EventEntry에 추가할지

- EventEntry는 발생주체에 대한 정보가 없어서 `Order`에서 발생한 이벤트만 조회 같은 기능 구현이 불가능함
- 이러한 기능을 구현하기 위해서는 이벤트에 발생 주체 정보를 추가해야함

<br>

### 포워더의 전송 실패 임계치

- 실패한 이벤트에 대해서 다시 읽어서 전달하지만 계속 실패하고 임계값이 없는경우 해당 메세지에서 빠져나가지 못함
- 포워더를 구현할때는 임계값을 정해야하며, 예를 들어 이벤트 전송을 `3회` 실패했다면 해당 이벤트는 생략하고 다음 이벤트로 넘어가는 등 정책이 필요함

<br>

### 이벤트 손실

- 이벤트 저장소를 사용하는 방식은 발생과 이벤트 저장이 1개의 트랜잭션에서 발생하므로 데이터 보장이 가능함
- 로컬 핸들러를 사용해서이벤트를 비동기로 처리하는 경우 이벤트 처리에 실패하면 해당 이벤트는 유실됨

<br>

### 이벤트 처리 순서

- 이벤트 발생 순서대로 외부 시스템에 전달해야하는 경우, 이벤트 저장소를 사용하는게 좋음
  - 저장소에 이벤트를 발생 순서대로 저장하고, 그 순서대로 이벤트 목록을 제공함
- 메세징 시스템은 사용기술에 따라서 이벤트 발생 순서와 메세지 전달 순서가 다를수도 있음

<br>

### 이벤트 재처리

- 동일한 이벤트를 다시 처리해야 할 때 이벤트를 어떻게 할지 결정이 필요함
- 가장 쉬운 방법은 마지막으로 처리한 이벤트의 순번을 기억해두고 이미 처리한 순번의 이벤트가 도착하면 해당 이벤트를 무시하는것임
- 이외에도 이벤트를 `멱등`으로 처리하는 방법도 존재함

#### 멱등으로 처리하기

- 연산을 여러 번 적용해도 결과가 달라지지 않는 성질을 `멱등성`이라고 부름

<br>

# 이벤트 처리와 DB 트랜잭션 고려하기

- 이벤트를 처리할 때는 DB 트랜잭션을 함께 고려하는게 좋다
- 동기, 비동기 방법에 상관 없이 모든 이벤트 처리 실패와 트랜잭션 실패에 대한것을 함께 고려해야한다
- 경우의 수를 줄이는 방법은 트랜잭션 처리가 성공할 때만 이벤트 핸들러를 실행하는 방법이다
