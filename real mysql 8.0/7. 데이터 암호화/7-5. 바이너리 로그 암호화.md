# 바이너리 로그 암호화

- 리두/언두 로그와 다르게 특수한 목적으로 바이너리 로그는 디스크에 장기간 보관될수 있음
- 바이너리 로그는 실제 디스크에 저장된 파일에 대해서만 암호화를 제공함
  - 소스-레플리카 등 네트워크 구간에서 로그데이터에 대한 암호화는 제공하지 않음
  - 만약 암호화가 필요한 경우 TLS/SSL 통신을 통해서 가능함

### 암호화 키 관리

- 동일하게 파일키로 암호화 해서 디스크에 저장되고, 파일키는 각 로그의 헤더에 저장한다
- `ALTER INSTANCE ROTATE INNODB MASTER KEY`으로 마스터 키 변경이 가능하다

#### 마스터 키 변경시 발생하는 일

- 증가된 시퀀스 번호와 새로운 로그 암호화 키 발급 후 키링 파일에 저장
- 바이너리 로그 파일과 릴레이 로그 파일 스위칭
- 바이너리 로그 파일 키로 파일키를 암호화 하고 각 로그파일에 저장
- 기존 바이너리, 릴레이 로그 파일 키를 읽어서 새로운 바이너리 로그 파일키로 암호화 후 저장
- 기존 바이너리 로그 암호화 키를 키링에서 제거

```sql
mysql> show binary logs;
+---------------+-----------+-----------+
| Log_name      | File_size | Encrypted |
+---------------+-----------+-----------+
| binlog.000001 |       668 | Yes       |
| binlog.000002 |  89088804 | Yes       |
+---------------+-----------+-----------+
2 rows in set (0.00 sec)
```

<br>

# mysqlbinlog 활용

- 한번 암호화 되면 바이너리 로그 암호화 키가 없으면 복호화가 불가능함
- 하지만 바이너리 로그 암호화 키는 MySQL 서버에서 가지고 있어서 복호화가 불가능함
- `--read-from-remote-server` 옵션을 추가하면 복호화가 가능함

```sql
linux> mysqlbinlog --read-from-remote-server --start-position=mysql-bin.000001 --stop-position=mysql-bin.000002 --database=test --user=root --password=password --host=127.0.0.1 --port=3306
```
