# 에러 로그 파일

- my.cnf가 정의되어 있다면 log_error 라는 파리미터로 지정된 경로에 생성됨
- 별도로 정의되지 않은 경우 datadir 파라미터에 설정된 폴더에 .err 라는 확장자로 생성됨

<br/>

### MySQL이 시작되는 과정과 관련된 정보성 및 에러 메세지

- 설정파일 변경, DB가 비정상적인 재부팅이 발생한 경우 에러 로그 파일을 통해서 설정한 변수 이름이나 값이 잘 적용됬는지 확인이 필요함
- `mysqld: ready for connections`는 잘 됬다는 뜻이다
- `ignore`: 구동은 잘 됬지만 일부 환경변수가 무시됬다
- 그 외의 경우는 에러가 발생하면서 서버가 구동되지 않는다

<br/>

### 마지막으로 종료할 때 비정상적으로 종료하는 경우 나타내는 트랜잭션 복구 메세지

- InnoDB의 경우 마지막으로 완료되지 않은 트랜잭션을 자동으로 복구해줌
- 이 과정에서 에러가 발생하면 메세지를 출력하고 MySQL은 다시 종료됨
- `innodb_force_recovery`를 사용해서 복구를 해야될수도 있음

<br/>

### 쿼리 처리 도중 발생하는 에러메세지

- 사전 예방이 힘들고 자주 에러로그를 검토하는게 숨겨진 문제점을 해결하기에 제일 좋다

<br/>

### 비정상적으로 종료된 커넥션 메세지 - Aborted Connection

- 네트워크 문제나 기타 문제로 자주 발생하는 로그다
- 특정 호스트에서 에러로 인해서 `max_connect_errors`를 넘어가면 기록됨
- 단순하게 값을 높여도 되지만, 원인을 파악하고 해결하는게 제일 좋음

<br/>

### InnoDB 모니터링 또는 상태 조회 명령 결과값

- 테이블, 락 모니터링이나 엔진 상태를 조회하는 명령은 큰 메세지를 로그에 남김
- 모니터링을 사용한 이후는 다시 비활서화 해서 에러 로그 파일이 커지지않게 만드는게 좋음

<br/>

### MySQL의 종료 메세지

- 아무도 모르게 종료되거나 재부팅되는 경우가 가끔 존재함
- 로그에서 `Reveived SHUTDOWN from user..`는 특정 유저가 강제로 셧다운 한 로그다
- 아무런 내용 없이 스택 트레이스처럼 16진수 주소값이 잔뜩 나오면 세그먼테이션 폴트로 판단이 가능함
- 버전에 버그가 있는지 확인하고, 버전을 올리거나 등 해결책을 빠르게 찾아야한다

<br/>

# 제너럴 쿼리 로그(제너럴 로그 파일, General Log)

- MySQL에서 실행된 모든 쿼리를 기록하는 파일
- `log_output` 파라미터를 통해서 테이블 또는 외부 파일로 저장이 가능함
- `general_log_file` 파라미터로 저장위치를 지정할 수 있음
- 모든 실행됬던 쿼리는 시간 단위로 저장됨
- 쿼리 성공/실패 구분없이 일단 요청이 들어온 쿼리는 모두 저장됨

<br/>

# 슬로우 쿼리 로그

- `long_query_time` 시스템 변수에 설정한 시간보다 오래걸린 쿼리를 뜻한다
- 쿼리가 성공했을때 걸린 시간을 기준으로 판단하기에 오류가 발생한 쿼리는 기록되지 않는다
- 동일하게 `log_output`로 저장방식 결정이 가능하다
  - 제너럴, 슬로우 모두 DB에 저장시 CSV 엔진을 사용하므로 CSV 파일로 저장하는것과 동일하다

<br/>

### 슬로우 쿼리 분석

- 내부에는 Time, User 등 다양한 항목이 존재한다
- Query_Time 내부에는 Lock_Time이 존재하는데 해당 값이 0이 아니라고 무조건 락으로 인한 대기가 있다고 생각하면 안된다
  - 잠금 체크와 같은 코드 실행시간도 모두 포함된다
  - 이 값이 매우 작은 편이면 무시해도 무방하다
- InnoDB의 경우 Lock_Time이 쿼리엔진 레벨에서 자체적으로 사용하는 시간까지 포함된다
  - InnoDB 테이블에만 접근하는 쿼리의 슬로우 로그는 해당 값이 별로 도움되지 않는다

<br/>

### 슬로우 쿼리 좀 더 쉽게 분석하기

- 자체적으로 제공하는 로그의 경우 보기가 힘들고 불친절하다
- Percona에서 개발한 Percona Toolkit의 pt-query-digest 도구를 사용하면 쉽게 분석할 수 있음
