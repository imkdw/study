# 파티션의 제약사항

- `PARTITION BY RANGE(YEAR(REG_DATE))` 문구 설명
  - 해당 절이 선언되어 있다면 그 테이블은 레인지 파티션을 사용한다는 의미다
  - 파티션 컬럼은 reg_date이며 YEAR 내장 함수로 연도만 추출해서 그 연도를 기준으로 범위별로 파티션한다
- 파티션 테이블 FK 사용 불가, 임시 테이블 사용불가 등 다양한 제약이 존재한다
  - 가장 큰 영향을 받는건 모든 유니크 인덱스에 파티션 키 컬럼이 포함되어야 한다는 제약이다
  - 일반적으로 auto_increment 키 하나로도 충분하지만 파티션 키와 복합키를 생성해야한다
- 파티션 표현식에는 산술연산이나 일부 내장함수 사용이 가능하고 사전에 프루닝이 잘 되는지 앱에 적용하는게 좋다

<br>

# 파티션 사용시 주의사항

### 파티션과 유니크 키(기본키 포함)

- 종류와 관계없이 유니크 인덱스가 있다면 파티션 키는 모든 유니크 인덱스의 일부 또는 모든 컬럼을 포함해야함

```sql
create table tb_partition (
	fd1 int not null,
	fd2 int not null,
	fd3 int not null,
	unique key(fd1, fd2, fd3)
) partition by hash(fd1)
partitions 4;
```

<br>

### 파티션과 open_files_limit 변수

- MySQL은 테이블을 파일 단위로 관리해서 동시에 오픈된 파일의 개수가 많아질 수 있다
- 일반적인 테이블은 오픈된 파일 개수가 2~3개 정도나 파티션은 (파티션 개수 \* 2~3)이 되버린다
- 파티션을 많이 사용하는 경우는 해당 변수를 적절히 높은값으로 다시 설정할 필요가 있다
