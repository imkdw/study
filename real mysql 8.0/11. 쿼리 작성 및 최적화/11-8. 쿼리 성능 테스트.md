# 쿼리의 성능에 영향을 미치는 요소

- 카장 큰 변수는 MySQL 서버가 가지고있는 여러 종류의 버퍼나 캐시다

<br>

### 운영체제의 캐시

- 일반적으로 대부분의 운영체제는 한 번 읽어온 값을 운영체제 자체의 캐시 영역에 캐싱한다
- MyISAM과 다르게 InnoDB의 경우는 파일시스템의 캐시나 버퍼를 거치지 않는 Direct I/O를 사용한다
- OS에서 캐싱하고 있는 데이터를 날리고 테스트를 하는걸 권장한다

```bash
# 캐시, 버퍼 내용을 디스크와 동기화
linux> sync

# OS에 포함된 캐시의 내용을 포기화
linux> echo 3 > /proc/sys/vm/drop_caches
```

<br>

### MySQL 서버의 버퍼 풀

- InnoDB의 경우 인덱스 페이지, 데이터 페이지, 버퍼링 작업 등 모든걸 겸해서 처리함
- MySQL 서버가 시작된 이상 이러한 데이터를 러닝타임중에 초기화 할 수 있는 방법이 없다
- 초기화를 할려면 MySQL 자체를 재부팅 해야한다
- 또한 종료될때 덤프한 데이터를 다시 불러오는데 `innodb_buffer_pool_load_at_startup`으로 제어가 가능하다

<br>

### 독립된 MySQL 서버

- 만약 동일한 서버에 무거운 작업이 실행된다면 디비에도 영향을 미친다
- 또한 테스트 쿼리를 실행하는 클라이언트 프로그램이나 네트워크의 영향 요소도 고려해야한다

<br>

### 쿼리 테스트 횟수

- 테스트를 할때는 워밍업(캐시, 버퍼등 준비완료) 또는 콜드(캐시, 버퍼 초기화)처럼 어떤 상황에서 할지도 중요하다
- 대부분의 운영서버의 경우 워밍업 상태에서 진행되며, 테스트 쿼리를 6~7번 정도 실행해서 중간값으로 비교하는게 좋다
