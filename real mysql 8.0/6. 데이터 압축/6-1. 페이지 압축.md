# 페이지 압축 - Transparent Page Compression

- 서버가 디스크에 저장하는 시점에 데이터 페이지가 압축되어 저장
- 서버가 디스크에서 데이터를 읽어오는 시점에 압축이 해제
- 버퍼 풀에 데이터가 한번 적재되면 InnoDB 스토리지 엔진은 압축이 해제된 상태로만 관리
- 유저의 입장에서는 투명하게 작동함
- 문제점이 있다면 16KB의 데이터 페이지를 압축한 결과가 용량이 얼마나 될지 예측이 불가능함
  - 적어도 하나의 테이블은 동일한 크기의 페이지로 통일되어야 해서 펀치홀 기능을 사용함

<br/>

### 펀치 홀 기능

#### 과정

- 16KB 페이지를 압축 -> 7KB가 된다고 가정
- 디비는 디스크에 압축된 결과 7KB를 저장, 남는 공간은 9KB로 기록
- 디스크에 데이터 저장하고, 남은 9KB 공간에 대해서는 펀치 홀 생성
- 파일시스템은 7KB만 남기고, 9KB는 OS에 반납함

#### 문제점

- 펀치 홀 기능은 운영체제랑 하드웨어 모두 지원해야 사용이 가능함
- 또한 백업 등 디비 자체에만 있는게 아니라 외부에서도 파일이 존재함
- 실제 페이지의 크기가 1GB지만 cp 명령어나 복구툴을 사용하면 펀치홀이 채워져서 10GB가 될수도 있음
- 실제로 페이지 압축 기능은 많이 사용하지 않음

```sql
create table page_compression (
	id INT primary key auto_increment
) COMPRESSION="zlib";
```
