# 저장 방식

- 내부적으로는 JSON 타입의 값을 BLOB 타입에 저장함
- 그대로 저장하는게 아닌 바이너리 포멧인 BSON 형태로 변환해서 저장됨
- TEXT, BLOB 보다는 JSON 타입에 저장하는게 공간 효율이 높은편임
- 만약 16KB보다 큰 json이 저장되는 경우는 16kb 단위로 쪼개서 여러개의 데이터 페이지로 나눠서 저장함
- 8 버전 부터는 각 blob 페이지의 인덱스를 관리하고 실제 blob 데이터를 가진 페이지의 링크를 저장하는 식으로 바뀜

<br>

# 부분 업데이트

- json_set(), json_replace(), json_remove() 함수로 제어할때만 작동함
- 부분 업데이트가 적용됬는지 확인할 수 있는 정확한 방법은 존재하지 않음
- 실제 컬럼은 4GB까지의 데이터를 가질 수 있지만 1MB의 데이터만 저장되도 64개의 페이지로 ㅂ쪼개짐
- 만약 부분업데이트를 사용하지 않는다면 64개의 페이지를 다시 디스크로 기록해야됨
- 변경사항이 바이너리 로그에 기록될 때 `binlog_row_value_options`, `binlog_row_image` 값을 변경하면 부분 업데이트 성능을 더 빠르게 만들 수 있음
  - 하지만 가장 중요한건 JSON이 저장된 레코드의 기본키이다
  - 기본키가 없다면 복제에서 레플리카 서버는 업데이트할 레코드를 식별하기 위해 모든 레코드 컬럼이 필요하다

<br>

# JSON 타입 콜레이션과 비교

- 가공되어 나온 결과값은 모두 utf8mb4 + utf8mb4_bin 이다
- 바이너리 콜레이션이기 때문에 대소문자, 엑센트 문자 등도 구분해서 비교하게된다

<br>

# JSON 컬럼 선택

- 부분 업데이트 등 부가기능이 많으므로 JSON을 저장할때는 text, blob 대신 json을 권장한다
- 이러한 json 필드는 데이터 정규화를 하게되면 필요하지 않은데, 이 때 성능을 중심이라면 정규화를 권장한다
- 또한 저장공간의 경우도 json은 매번 키값을 다 명시하는데 정규화보다는 공간을 더 사용하게 된다
-
