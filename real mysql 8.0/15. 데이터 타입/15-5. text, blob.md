# TEXT(문자열), BLOB(이진)

- 주로 대량의 데이터를 저장해야될때 사용하는 타입
- 두 개의 차이점은 문자 집합과 콜레이션을 가지는지에 대한 여부에 있다
- TINY(255), 일반(65535), MEDIUM(16777215), LONG(4294967295)로 최대 길이를 제한한다
- 두개 다 사용할 때 주의하고 너무 남용해서는 안된다

<br>

### 사용지 주의사항

- 보통 둘 다 컬럼 하나에 저장되는 값이 길이가 예측할 수 없이 클 때 사용한다
- 하지만 다른 MySQL은 4000바이트를 넘을때 반드시 써야하는건 아니다
- 레코드의 전체 크기가 64kb를 넘지 않는다면 varchar이나 varbinary를 사용해도된다

<br>

### 인덱스 관련 내용

- 포맷마다 다르지만 8 버전 기준인 `DYNAMIC`에서는 인덱스 생성시 3072 바이트의 제한을 가지고 있다
- 자주 사용되지는 않지만 인덱스를 생성할 때 컬럼값의 몇 바이트까지 인덱스로 사용할지 명시해야될수도 있음
- utf8mb4의 경우 768글자 까지만 인덱스로 생성이 가능함
- 실제로 저장된 값이 10MB 이렇게 높아도 `max_sort_length`에 의해서 설정된 길이까지만 정렬을 수행함
- 기본값은 1024바이트인데 만약 text 컬럼에 대해서 정렬을 더 빠르게 수행할려면 이걸 줄이는게 좋음

<br>

### 데이터 크기에 따른 에러

- `max_allowed_packet`에 의해서 값이 큰 TEXT, BLOB이 포함된 SQL은 에러가 발생할수도 있음
- 대용량의 컬럼 값을 사용한다면 늘려주는게 좋음

<br>

### 대용량 데이터의 저장 위치

- 가능하면 이러한 큰 컬럼도 다른 레코드와 같이 저장할려고 하지만 최대 길이 제한으로 불가능할때도 있다
- 5.6에서 사용하던 기본 ROW_FORMAT인 COMPACT는 데이터 페이지 크기 16KB의 절반인 8126 바이트다
- 만약 레코드의 전체 길이가 8126 바이트가 넘어간다면 용량이 큰 컬럼 순서대로 외부 페이지로 옮기면서 레코드의 크기를 8126 바이트로 맞출려고 한다
  - 이 때 외부 페이지는 Off-Page, External-Page 이다
- 해당 데이터는 여러개의 외부 페이지에 저장하고, 각 페이지는 체인으로 연결함

<br>

### 기본키 페이지에 저장되는 blob, text

- compact, redundant의 경우는 외부 페이지로 저장된 컬럼의 앞쪽 768 바이트를 때서 기본키 페이지에 저장함
  - 인덱스 생성시 도움이 되기도 하지만 저장 효율을 낮출수도 있음
- 하지만 dynamic, compressed에서는 저장하지 않음
  - blob, text 컬럼을 where 또는 join에서 참조하게 되면 쿼리 성능이 더 떨어짐
